<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sales Map</title>

  <!-- Main CSS -->
  <link rel="stylesheet" href="/static/style.css">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <!-- Chart.js + datalabels (for side charts) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script>
    Chart.register(ChartDataLabels);
  </script>
</head>
<body>
  <h2>Sales Map</h2>

  <div id="topRow" class="controls"
       style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;">

    <div id="catBtns" style="display:flex; gap:6px; flex-wrap:wrap;">
      <button class="btn active" data-val="ALL">All</button>
      <button class="btn" data-val="PCLT">PCLT</button>
      <button class="btn" data-val="TBR">TBR</button>
      <button class="btn" data-val="18PLUS">18+ Inch</button>
      <button class="btn" data-val="ISEG">EV/iSeg</button>
      <button class="btn" data-val="SUV">SUV</button>
      <button class="btn" data-val="LOWPROFILE">Low profile / Strategic TBR</button>
      <button class="btn" data-val="HM">HM</button>
    </div>

    <div id="metricBtns" class="controls" style="gap:6px; margin-left:50px;">
      <button class="btn" data-metric="qty">Qty</button>
      <button class="btn" data-metric="amount">Amount</button>
    </div>

    <label style="margin-left:50px;">Group By:</label>
    <select id="group_by">
      <option value="region" selected>Region</option>
      <option value="salesman">Salesman</option>
      <option value="sold_to_group">Sold-to Group</option>
      <option value="sold_to">Sold-to</option>
      <option value="product_group">Product Group</option>
    </select>

    <div id="viewSwitch" style="margin-left:auto; display:flex; gap:6px;">
      <button class="btn" onclick="window.location.href='/'">Graph View</button>
      <button class="btn active">Map View</button>
    </div>
  </div>

  <div class="controls">
    <div id="regionBtns" class="controls" style="gap:6px;">
      <button class="btn" data-val="ALL">ALL</button>
      <button class="btn" data-val="NSW">NSW</button>
      <button class="btn" data-val="QLD">QLD</button>
      <button class="btn" data-val="VIC">VIC</button>
      <button class="btn" data-val="WA">WA</button>
    </div>

    <label>Salesman:</label>
    <select id="salesman_name"><option value="ALL">ALL</option></select>

    <label>Sold-to Group:</label>
    <select id="sold_to_group"><option value="ALL">ALL</option></select>

    <div id="topCustomerControls" class="controls">
      <button class="btn active" data-limit="0">All</button>
      <button class="btn" data-limit="10">Top 10</button>
      <button class="btn" data-limit="20">Top 20</button>
      <button class="btn" data-limit="30">Top 30</button>
    </div>

    <label for="sold_to">Sold-to:</label>
    <input type="text" id="sold_to" placeholder="Search Sold-to..." list="sold_to_list" />
    <datalist id="sold_to_list"></datalist>

    <label style="margin-left:8px;">Ship-to:</label>
    <input list="ship_to_list" id="ship_to" placeholder="Search Ship-to..." />
    <datalist id="ship_to_list"></datalist>

    <label>Product Group:</label>
    <select id="product_group"><option value="ALL">ALL</option></select>

    <label style="margin-left:8px;">Pattern:</label>
    <input list="pattern_list" id="pattern" placeholder="Search Pattern" />
    <datalist id="pattern_list"></datalist>
  </div>

  <div id="mapLayout" class="chart-row" style="margin-top:4px;">
    <div id="mapWrapper" class="box" style="flex:2;">
      <div id="salesMap"></div>
    </div>

    <div id="mapSidePanel" class="box" style="flex:1;">
      <h3 id="shopTitle">Click a shop on the map</h3>
      <div class="chartPane">
        <canvas id="monthlyChart"></canvas>
      </div>
      <div class="chartPane">
        <canvas id="yearlyChart"></canvas>
      </div>
    </div>
  </div>

  <div id="errbar" class="errbar" hidden></div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- shared dashboard logic -->
  <script src="/static/app.js" defer></script>
  <!-- small map-specific layer that reuses app.js -->
  <script src="/static/map.js" defer></script>
</body>
</html>
